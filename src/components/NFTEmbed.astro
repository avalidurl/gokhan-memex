---
interface Props {
  url: string
  title?: string
  creator?: string
  description?: string
  image?: string
  contractAddress?: string
  tokenId?: string
}

const { url, title, creator, description, image, contractAddress, tokenId } = Astro.props

// Extract platform and basic info from URL
function parseNFTUrl(url: string) {
  try {
    if (url.includes('zora.co')) {
      return { platform: 'Zora', displayUrl: url, action: 'Collect on Zora' }
    } else if (url.includes('foundation.app')) {
      return { platform: 'Foundation', displayUrl: url, action: 'Collect on Foundation' }
    } else if (url.includes('opensea.io')) {
      return { platform: 'OpenSea', displayUrl: url, action: 'View on OpenSea' }
    } else if (url.startsWith('nft://')) {
      return { platform: 'NFT Protocol', displayUrl: url, action: 'Collect' }
    } else if (url.startsWith('ethereum://')) {
      return { platform: 'Ethereum', displayUrl: url, action: 'View on Etherscan' }
    } else {
      return { platform: 'NFT', displayUrl: url, action: 'View NFT' }
    }
  } catch {
    return { platform: 'NFT', displayUrl: url, action: 'View NFT' }
  }
}

const nftInfo = parseNFTUrl(url)
const displayTitle = title || 'Untitled'

// Generate URLs from contract address and token ID
const etherscanUrl = contractAddress && tokenId 
  ? `https://etherscan.io/nft/${contractAddress}/${tokenId}`
  : url.replace('zora.co', 'etherscan.io')

const openSeaUrl = contractAddress && tokenId
  ? `https://opensea.io/assets/ethereum/${contractAddress}/${tokenId}`
  : null

const zoraUrl = contractAddress && tokenId
  ? `https://zora.co/collect/eth:${contractAddress}/${tokenId}`
  : null

// Use the most appropriate primary action URL
const primaryUrl = url || zoraUrl || openSeaUrl || etherscanUrl
---

<div class="my-6 not-prose">
  <div class="bg-white rounded-lg border border-gray-200 p-4 mx-auto max-w-full overflow-hidden">
    <div class="flex flex-col gap-4">
      <!-- NFT Image -->
      {image && (
        <img 
          src={image} 
          alt={displayTitle}
          class="w-full max-w-full rounded-lg"
          style="height: auto;"
          loading="lazy"
        />
      )}
      
      <!-- NFT Info -->
      <div class="space-y-2">
        <h4 class="text-lg font-semibold text-gray-900">{displayTitle}</h4>
        
        {creator && (
          <p class="text-sm text-gray-500">By {creator}</p>
        )}
        
        {description && (
          <p class="text-sm text-gray-600 leading-relaxed">{description}</p>
        )}
      </div>
      
      <!-- Action Buttons -->
      <div class="flex flex-col gap-2">
        <a
          href={primaryUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="w-full inline-flex items-center justify-center px-4 py-2.5 bg-black text-white rounded-md hover:bg-gray-800 transition-colors text-sm font-medium"
        >
          {nftInfo.action}
        </a>
        <div class="flex gap-2">
          {zoraUrl && (
            <a
              href={zoraUrl}
              target="_blank"
              rel="noopener noreferrer"
              class="flex-1 inline-flex items-center justify-center px-3 py-2 border border-gray-300 bg-white text-gray-700 rounded-md hover:bg-gray-50 transition-colors text-xs"
            >
              Zora
            </a>
          )}
          {openSeaUrl && (
            <a
              href={openSeaUrl}
              target="_blank"
              rel="noopener noreferrer"
              class="flex-1 inline-flex items-center justify-center px-3 py-2 border border-gray-300 bg-white text-gray-700 rounded-md hover:bg-gray-50 transition-colors text-xs"
            >
              OpenSea
            </a>
          )}
          <a
            href={etherscanUrl}
            target="_blank"
            rel="noopener noreferrer"
            class="flex-1 inline-flex items-center justify-center px-3 py-2 border border-gray-300 bg-white text-gray-700 rounded-md hover:bg-gray-50 transition-colors text-xs"
          >
            Etherscan
          </a>
        </div>
      </div>
    </div>
  </div>
</div>