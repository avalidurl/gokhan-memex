---
import { Menu, X, Search } from 'lucide-astro'
import ThemeToggle from './ThemeToggle.astro'
import SearchComponent from './Search.astro'

const currentPath = Astro.url.pathname
const isArticle = currentPath.startsWith('/journal/') && currentPath !== '/journal/' && currentPath !== '/journal'

const navigation = [
  { name: 'Journal', href: '/journal' },
  { name: 'Archive', href: '/archive' },
  { name: 'Lists', href: '/lists' },
  { name: 'Contact', href: '/subscribe' }
]
---

<header class="sticky top-0 z-50 w-full bg-background/95 backdrop-blur-sm supports-[backdrop-filter]:bg-background/80">
  <div class="mx-auto max-w-5xl px-6 lg:px-8">
    <div class="flex h-14 items-center justify-between">
      <!-- Left side: Logo/Name or Back button -->
      <div class="flex items-center">
        {isArticle ? (
          <a 
            href="/journal" 
            class="flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors"
            aria-label="Back to Journal"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12" />
            </svg>
            <span class="text-sm font-medium hidden sm:inline">Close</span>
          </a>
        ) : (
          <a 
            class="font-serif text-lg tracking-tight text-foreground hover:text-foreground/80 transition-colors" 
            href="/"
          >
            GÃ¶khan Turhan
          </a>
        )}
      </div>

      <!-- Center: Navigation Links (Desktop only, not on article pages) -->
      {!isArticle && (
        <nav class="hidden md:flex items-center gap-8">
          {navigation.map((item) => (
            <a
              href={item.href}
              class={`text-sm transition-colors ${
                currentPath === item.href || currentPath.startsWith(item.href + '/')
                  ? 'text-foreground font-medium' 
                  : 'text-muted-foreground hover:text-foreground'
              }`}
            >
              {item.name}
            </a>
          ))}
        </nav>
      )}

      <!-- Right side: Actions -->
      <div class="flex items-center gap-1">
        <!-- Search Button -->
        <button 
          id="search-button"
          class="p-2 text-muted-foreground hover:text-foreground transition-colors rounded-md hover:bg-muted/50"
          aria-label="Search"
        >
          <Search class="h-4 w-4" />
        </button>
        
        <!-- Theme Toggle -->
        <ThemeToggle />

        <!-- Mobile Menu Button (not on article pages) -->
        {!isArticle && (
          <button 
            class="md:hidden p-2 text-muted-foreground hover:text-foreground transition-colors rounded-md hover:bg-muted/50" 
            id="mobile-menu-button"
            aria-label="Toggle menu"
          >
            <Menu class="h-5 w-5" id="menu-icon" />
            <X class="h-5 w-5 hidden" id="close-icon" />
          </button>
        )}
      </div>
    </div>
  </div>

</header>

<!-- Mobile Navigation Overlay - Outside header for proper stacking -->
<div class="md:hidden hidden fixed inset-x-0 top-14 bottom-0 bg-background z-50 overflow-y-auto" id="mobile-menu">
  <nav class="flex flex-col px-6 py-6">
    {navigation.map((item) => (
      <a
        href={item.href}
        class={`py-4 text-xl border-b border-border/30 transition-colors ${
          currentPath === item.href || currentPath.startsWith(item.href + '/')
            ? 'text-foreground font-medium' 
            : 'text-muted-foreground hover:text-foreground'
        }`}
      >
        {item.name}
      </a>
    ))}
    <a 
      href="/rss.xml" 
      class="py-4 text-xl text-muted-foreground hover:text-foreground transition-colors"
    >
      RSS Feed
    </a>
  </nav>
</div>

<!-- Search Modal -->
<SearchComponent />

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const button = document.getElementById('mobile-menu-button')
    const menu = document.getElementById('mobile-menu')
    const menuIcon = document.getElementById('menu-icon')
    const closeIcon = document.getElementById('close-icon')

    button?.addEventListener('click', () => {
      const isHidden = menu?.classList.contains('hidden')
      
      if (isHidden) {
        menu?.classList.remove('hidden')
        menuIcon?.classList.add('hidden')
        closeIcon?.classList.remove('hidden')
        document.body.style.overflow = 'hidden'
      } else {
        menu?.classList.add('hidden')
        menuIcon?.classList.remove('hidden')
        closeIcon?.classList.add('hidden')
        document.body.style.overflow = ''
      }
    })

    // Close menu on navigation
    const menuLinks = menu?.querySelectorAll('a')
    menuLinks?.forEach(link => {
      link.addEventListener('click', () => {
        menu?.classList.add('hidden')
        menuIcon?.classList.remove('hidden')
        closeIcon?.classList.add('hidden')
        document.body.style.overflow = ''
      })
    })
  })
</script>
