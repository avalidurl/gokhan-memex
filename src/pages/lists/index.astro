---
import { getCollection } from 'astro:content'
import BaseLayout from '@/layouts/BaseLayout.astro'
import Breadcrumbs from '@/components/Breadcrumbs.astro'
import ListItem from '@/components/ListItem.astro'
import Card from '@/components/ui/Card.astro'
import CardContent from '@/components/ui/CardContent.astro'
import Accordion from '@/components/ui/Accordion.astro'
import AccordionItem from '@/components/ui/AccordionItem.astro'
import AccordionTrigger from '@/components/ui/AccordionTrigger.astro'
import AccordionContent from '@/components/ui/AccordionContent.astro'
import Badge from '@/components/ui/Badge.astro'
import { formatDate } from '@/lib/utils'

// Import lists data
import listsData from '@/data/lists.json'

const breadcrumbs: { label: string; href: string }[] = []

// Get all published blog posts for music and books categories
const allPosts = (await getCollection('blog'))
  .filter(post => !post.data.draft)
  .sort((a, b) => new Date(b.data.publishDate).valueOf() - new Date(a.data.publishDate).valueOf())

const musicPosts = allPosts.filter(post => post.data.category === 'Music')
const bookPosts = allPosts.filter(post => 
  post.data.category === 'Books' || 
  (post.data.tags && post.data.tags.includes('books'))
)

// Use imported data
const lists = {
  people: listsData.people,
  books: []
}

---

<BaseLayout
  title="Lists"
  description="Curated lists of people, books, and music that inform my research across fintech, deep tech, and emerging technologies."
>
  <div class="container max-w-4xl mx-auto px-4 py-8">
    <Breadcrumbs items={breadcrumbs} currentPage="Lists" />

    <!-- Header -->
    <div class="mb-12">
      <h1 class="text-3xl md:text-4xl font-bold tracking-tight mb-4">Lists</h1>
      <p class="text-lg text-muted-foreground max-w-2xl">
        Curated collections of people, books, and music that inform my research and thinking across fintech, deep tech, and emerging technologies.
      </p>
    </div>

    <!-- Accordion Lists -->
    <div class="space-y-6">
      <Accordion class="w-full">
        <!-- People List -->
        <AccordionItem data-accordion-item class="border rounded-lg">
          <AccordionTrigger class="text-left">
            <div class="flex items-center justify-between w-full pr-4">
              <h2 class="text-xl font-semibold">People</h2>
              <Badge variant="secondary">{lists.people.length}</Badge>
            </div>
          </AccordionTrigger>
          <AccordionContent>
            <div class="grid gap-4">
              {lists.people.length === 0 && (
                <p class="text-sm text-muted-foreground italic text-center py-4">
                  People recommendations will be added here over time.
                </p>
              )}
              {lists.people.map(person => (
                <ListItem
                  name={person.name}
                  url={person.url}
                  description={person.description}
                  category={person.category}
                />
              ))}
            </div>
          </AccordionContent>
        </AccordionItem>

        <!-- Books List -->
        <AccordionItem data-accordion-item class="border rounded-lg">
          <AccordionTrigger class="text-left">
            <div class="flex items-center justify-between w-full pr-4">
              <h2 class="text-xl font-semibold">Books</h2>
              <Badge variant="secondary">{bookPosts.length}</Badge>
            </div>
          </AccordionTrigger>
          <AccordionContent>
            <div class="space-y-4">
              <p class="text-sm text-muted-foreground mb-4">
                Book reviews and reading reflections from my journal.
              </p>
              <div class="grid gap-3">
                {bookPosts.map(post => (
                  <div class="flex items-start justify-between p-3 border rounded-lg hover:bg-accent/20 transition-colors">
                    <div class="flex-1">
                      <h3 class="font-medium">
                        <a href={`/journal/${post.slug}`} class="hover:text-primary transition-colors">
                          {post.data.title}
                        </a>
                      </h3>
                      <p class="text-xs text-muted-foreground mt-1">
                        {formatDate(post.data.publishDate)}
                      </p>
                      {post.data.description && (
                        <p class="text-sm text-muted-foreground mt-1 line-clamp-2">
                          {post.data.description}
                        </p>
                      )}
                      {post.data.tags && (
                        <div class="flex gap-1 mt-2">
                          {post.data.tags.slice(0, 3).map(tag => (
                            <Badge variant="outline" class="text-xs">{tag}</Badge>
                          ))}
                        </div>
                      )}
                    </div>
                  </div>
                ))}
                
                {bookPosts.length === 0 && (
                  <p class="text-sm text-muted-foreground italic text-center py-4">
                    Book reviews will appear here as content is published.
                  </p>
                )}
              </div>
            </div>
          </AccordionContent>
        </AccordionItem>

        <!-- Music List -->
        <AccordionItem data-accordion-item class="border rounded-lg">
          <AccordionTrigger class="text-left">
            <div class="flex items-center justify-between w-full pr-4">
              <h2 class="text-xl font-semibold">Music</h2>
              <Badge variant="secondary">{musicPosts.length}</Badge>
            </div>
          </AccordionTrigger>
          <AccordionContent>
            <div class="space-y-4">
              <p class="text-sm text-muted-foreground mb-4">
                Music-related posts from my journal, exploring sound art, playlists, and musical concepts.
              </p>
              <div class="grid gap-3">
                {musicPosts.map(post => (
                  <div class="flex items-start justify-between p-3 border rounded-lg hover:bg-accent/20 transition-colors">
                    <div class="flex-1">
                      <h3 class="font-medium">
                        <a href={`/journal/${post.slug}`} class="hover:text-primary transition-colors">
                          {post.data.title}
                        </a>
                      </h3>
                      <p class="text-xs text-muted-foreground mt-1">
                        {formatDate(post.data.publishDate)}
                      </p>
                      {post.data.tags && (
                        <div class="flex gap-1 mt-2">
                          {post.data.tags.slice(0, 3).map(tag => (
                            <Badge variant="outline" class="text-xs">{tag}</Badge>
                          ))}
                        </div>
                      )}
                    </div>
                  </div>
                ))}
                
                {musicPosts.length === 0 && (
                  <p class="text-sm text-muted-foreground italic text-center py-4">
                    Music posts will appear here after content migration.
                  </p>
                )}
              </div>
            </div>
          </AccordionContent>
        </AccordionItem>
      </Accordion>
    </div>

    <!-- Note -->
    <Card class="mt-8 bg-accent/20 border-accent">
      <CardContent class="p-6">
        <p class="text-sm text-muted-foreground">
          <strong>Note:</strong> These lists are continuously curated and updated. The music section will populate after content migration from the existing blog.
        </p>
      </CardContent>
    </Card>
  </div>
</BaseLayout>