---
import { getCollection } from 'astro:content'
import BaseLayout from '@/layouts/BaseLayout.astro'

// Import lists data
import listsData from '@/data/lists.json'

// Get all published blog posts for music and books categories
const allPosts = (await getCollection('blog'))
  .filter(post => !post.data.draft)
  .sort((a, b) => new Date(b.data.publishDate).valueOf() - new Date(a.data.publishDate).valueOf())

const musicPosts = allPosts.filter(post => post.data.category === 'Music')
const bookPosts = allPosts.filter(post => 
  post.data.category === 'Books' || 
  (post.data.tags && post.data.tags.includes('books'))
)

const people = listsData.people
---

<BaseLayout
  title="Lists"
  description="Curated collection of thought leaders, researchers, and writers shaping AI, rationality, fintech, and deep tech."
>
  <div class="mx-auto max-w-5xl px-6 py-12 lg:py-20">
    <!-- Header -->
    <header class="mb-10 lg:mb-12">
      <h1 class="text-4xl md:text-5xl tracking-tight mb-3">Lists</h1>
      <p class="text-lg text-muted-foreground">
        Curated recommendations of people, publications, and content I follow.
      </p>
    </header>

    <div class="space-y-5">
      <!-- Blogroll Section -->
      <section id="blogroll" class="eink-card">
        <details class="group" open>
          <summary class="flex items-center justify-between cursor-pointer list-none py-1 border-b border-border">
            <div>
              <h2 class="text-sm font-medium uppercase tracking-wider text-muted-foreground">
                Blogroll
              </h2>
              <p class="text-sm text-muted-foreground mt-1">
                Thinkers and writers on AI, rationality, economics, and technology.
              </p>
            </div>
            <span class="text-muted-foreground transition-transform group-open:rotate-180">
              ▼
            </span>
          </summary>
          <div class="space-y-3 pt-4">
            {people.map(person => (
              <div>
                <a 
                  href={person.url}
                  target={person.url.startsWith('/') ? '_self' : '_blank'}
                  rel={person.url.startsWith('/') ? '' : 'noopener'}
                  class="group/link block rounded-md px-2 py-1 transition-colors hover:bg-muted/50"
                >
                  <span class="text-foreground group-hover/link:underline decoration-1 underline-offset-2">
                    {person.name}
                  </span>
                  {!person.url.startsWith('/') && (
                    <span class="text-muted-foreground text-sm ml-1">↗</span>
                  )}
                  <span class="block text-sm text-muted-foreground mt-0.5">
                    {person.description}
                  </span>
                </a>
              </div>
            ))}
          </div>
        </details>
      </section>

      <!-- Books Section -->
      {bookPosts.length > 0 && (
        <section id="books" class="eink-card">
          <details class="group">
            <summary class="flex items-center justify-between cursor-pointer list-none py-1 border-b border-border">
              <div>
                <h2 class="text-sm font-medium uppercase tracking-wider text-muted-foreground">
                  Books
                </h2>
                <p class="text-sm text-muted-foreground mt-1">
                  Book reviews and reading reflections.
                </p>
              </div>
              <span class="text-muted-foreground transition-transform group-open:rotate-180">
                ▼
              </span>
            </summary>
            <div class="space-y-2 pt-4">
              {bookPosts.map(post => (
                <div>
                  <a 
                    href={`/journal/${post.slug}/`}
                    class="group/link flex flex-col gap-1 rounded-md px-2 py-1 transition-colors hover:bg-muted/50 sm:flex-row sm:items-baseline sm:justify-between"
                  >
                    <span class="text-foreground group-hover/link:underline decoration-1 underline-offset-2">
                      {post.data.title}
                    </span>
                    <span class="text-sm text-muted-foreground shrink-0">
                      {post.data.publishDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}
                    </span>
                  </a>
                </div>
              ))}
            </div>
          </details>
        </section>
      )}

      <!-- Music Section -->
      {musicPosts.length > 0 && (
        <section id="music" class="eink-card">
          <details class="group">
            <summary class="flex items-center justify-between cursor-pointer list-none py-1 border-b border-border">
              <div>
                <h2 class="text-sm font-medium uppercase tracking-wider text-muted-foreground">
                  Music
                </h2>
                <p class="text-sm text-muted-foreground mt-1">
                  Sound art, playlists, and musical explorations.
                </p>
              </div>
              <span class="text-muted-foreground transition-transform group-open:rotate-180">
                ▼
              </span>
            </summary>
            <div class="space-y-2 pt-4">
              {musicPosts.map(post => (
                <div>
                  <a 
                    href={`/journal/${post.slug}/`}
                    class="group/link flex flex-col gap-1 rounded-md px-2 py-1 transition-colors hover:bg-muted/50 sm:flex-row sm:items-baseline sm:justify-between"
                  >
                    <span class="text-foreground group-hover/link:underline decoration-1 underline-offset-2">
                      {post.data.title}
                    </span>
                    <span class="text-sm text-muted-foreground shrink-0">
                      {post.data.publishDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}
                    </span>
                  </a>
                </div>
              ))}
            </div>
          </details>
        </section>
      )}
    </div>
  </div>
</BaseLayout>

<style>
  /* Hide default marker */
  details summary::-webkit-details-marker {
    display: none;
  }
  
  details summary::marker {
    display: none;
  }
</style>
