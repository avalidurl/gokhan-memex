---
import { getCollection } from 'astro:content'
import BaseLayout from '@/layouts/BaseLayout.astro'

// Get all published blog posts
const allPosts = (await getCollection('blog'))
  .filter(post => !post.data.draft)

// Extract tags and their counts
const tagMap = new Map<string, number>()
allPosts.forEach(post => {
  post.data.tags?.forEach(tag => {
    tagMap.set(tag, (tagMap.get(tag) ?? 0) + 1)
  })
})

// Sort tags by count (descending)
const sortedTags = Array.from(tagMap.entries()).sort((a, b) => b[1] - a[1])
---

<BaseLayout
  title="All Tags"
  description={`Browse all ${sortedTags.length} tags`}
  robots="noindex, follow"
>
  <div class="mx-auto max-w-2xl px-6 py-12 lg:py-16">
    <!-- Header -->
    <header class="mb-12">
      <h1 class="text-3xl font-semibold tracking-tight mb-4">Tags</h1>
      <p class="text-muted-foreground">
        {sortedTags.length} tags across {allPosts.length} posts
      </p>
    </header>

    <div class="flex flex-wrap gap-2">
      {sortedTags.map(([tag, count]) => (
        <a 
          href={`/archive/tags/${tag.toLowerCase().replace(/\s+/g, '-')}`}
          class="text-sm text-muted-foreground hover:text-foreground transition-colors"
        >
          {tag} <span class="text-xs opacity-60">({count})</span>
        </a>
      ))}
    </div>

    <!-- Navigation -->
    <footer class="mt-12 pt-8 border-t border-border">
      <a 
        href="/archive"
        class="text-sm text-muted-foreground hover:text-foreground transition-colors"
      >
        ‚Üê Back to Archive
      </a>
    </footer>
  </div>
</BaseLayout>

