---
import BaseLayout from '@/layouts/BaseLayout.astro'
import { getCollection } from 'astro:content'

const projects = (await getCollection('projects')).sort(
  (a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf()
)

const featuredProjects = projects.filter(project => project.data.featured)
const otherProjects = projects.filter(project => !project.data.featured)
---

<BaseLayout 
  title="Projects" 
  description="A collection of projects, dashboards, and digital tools."
>
  <div class="mx-auto max-w-5xl px-6 py-12 lg:py-20">
    <!-- Header -->
    <header class="mb-10 lg:mb-12">
      <h1 class="text-4xl md:text-5xl tracking-tight mb-3">Projects</h1>
      <p class="text-lg text-muted-foreground">
        Dashboards, tools, and experiments.
      </p>
    </header>

    <div class="space-y-5">
      {featuredProjects.length > 0 && (
        <section class="eink-card">
          <h2 class="text-sm font-medium uppercase tracking-wider text-muted-foreground mb-4">
            Featured
          </h2>
          <ul class="space-y-3">
            {featuredProjects.map((project) => (
              <li>
                <a 
                  href={project.data.projectUrl || `/projects/${project.slug}/`}
                  target={project.data.projectUrl ? '_blank' : '_self'}
                  rel={project.data.projectUrl ? 'noopener' : ''}
                  class="group block rounded-md px-2 py-1 transition-colors hover:bg-muted/50"
                >
                  <span class="text-foreground group-hover:underline decoration-1 underline-offset-2">
                    {project.data.title}
                  </span>
                  {project.data.projectUrl && (
                    <span class="text-muted-foreground text-sm ml-1">↗</span>
                  )}
                  <span class="block text-sm text-muted-foreground mt-0.5">
                    {project.data.description}
                  </span>
                </a>
              </li>
            ))}
          </ul>
        </section>
      )}

      {otherProjects.length > 0 && (
        <section class="eink-card">
          <h2 class="text-sm font-medium uppercase tracking-wider text-muted-foreground mb-4">
            All Projects
          </h2>
          <ul class="space-y-3">
            {otherProjects.map((project) => (
              <li>
                <a 
                  href={project.data.projectUrl || `/projects/${project.slug}/`}
                  target={project.data.projectUrl ? '_blank' : '_self'}
                  rel={project.data.projectUrl ? 'noopener' : ''}
                  class="group block rounded-md px-2 py-1 transition-colors hover:bg-muted/50"
                >
                  <span class="text-foreground group-hover:underline decoration-1 underline-offset-2">
                    {project.data.title}
                  </span>
                  {project.data.projectUrl && (
                    <span class="text-muted-foreground text-sm ml-1">↗</span>
                  )}
                  <span class="block text-sm text-muted-foreground mt-0.5">
                    {project.data.description}
                  </span>
                </a>
              </li>
            ))}
          </ul>
        </section>
      )}

      {projects.length === 0 && (
        <p class="text-muted-foreground">
          No projects yet. Check back soon.
        </p>
      )}
    </div>
  </div>
</BaseLayout>
