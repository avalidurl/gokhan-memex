---
import { type CollectionEntry, getCollection } from 'astro:content'
import BaseLayout from '@/layouts/BaseLayout.astro'

export async function getStaticPaths() {
  const projects = await getCollection('projects')
  return projects.map((project) => ({
    params: { slug: project.slug },
    props: project,
  }))
}

type Props = CollectionEntry<'projects'>

const project = Astro.props
const { Content } = await project.render()

const publishDate = new Date(project.data.publishDate)
const formattedDate = publishDate.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long'
})
---

<BaseLayout 
  title={project.data.title} 
  description={project.data.description}
>
  <article class="mx-auto max-w-2xl px-6 py-12 lg:py-16">
    <header class="mb-12">
      <p class="text-sm text-muted-foreground mb-4">
        <a href="/projects" class="hover:underline underline-offset-2">← Projects</a>
      </p>
      <h1 class="text-3xl font-semibold tracking-tight mb-4">{project.data.title}</h1>
      <p class="text-muted-foreground mb-4">
        {project.data.description}
      </p>
      <p class="text-sm text-muted-foreground">
        {formattedDate}
      </p>
      
      {(project.data.projectUrl || project.data.githubUrl) && (
        <div class="flex gap-4 mt-6">
          {project.data.projectUrl && (
            <a 
              href={project.data.projectUrl}
              target="_blank"
              rel="noopener"
              class="text-foreground hover:underline decoration-1 underline-offset-2"
            >
              View project ↗
            </a>
          )}
          {project.data.githubUrl && (
            <a 
              href={project.data.githubUrl}
              target="_blank"
              rel="noopener"
              class="text-foreground hover:underline decoration-1 underline-offset-2"
            >
              Source ↗
            </a>
          )}
        </div>
      )}
    </header>

    <div class="prose prose-neutral dark:prose-invert max-w-none">
      <Content />
    </div>

    <footer class="mt-12 pt-8 border-t border-border">
      <a 
        href="/projects"
        class="text-muted-foreground hover:text-foreground hover:underline underline-offset-2"
      >
        ← Back to projects
      </a>
    </footer>
  </article>
</BaseLayout>
