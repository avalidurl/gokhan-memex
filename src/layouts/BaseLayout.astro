---
import Navigation from '@/components/Navigation.astro'
import ThemeProvider from '@/components/ThemeProvider.astro'
import PrivacyNotice from '@/components/PrivacyNotice.astro'
import OfflineStatus from '@/components/OfflineStatus.astro'
import '@/styles/globals.css'
import criticalStyles from '@/styles/critical.css?inline'

export interface Props {
  title: string
  description: string
  image?: string
  canonicalURL?: string
  type?: 'website' | 'article'
}

const {
  title,
  description,
  image = '/og-default.png',
  canonicalURL = new URL(Astro.url.pathname, Astro.site),
  type = 'website'
} = Astro.props

const siteName = 'Gökhan Turhan'
const fullTitle = title === siteName ? title : `${title} | ${siteName}`
---

<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    
    <!-- SEO -->
    <title>{fullTitle}</title>
    <meta name="description" content={description} />
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
    <meta name="googlebot" content="index, follow" />
    <link rel="canonical" href={canonicalURL} />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={type} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={fullTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(image, Astro.site)} />
    <meta property="og:site_name" content={siteName} />
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={fullTitle} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={new URL(image, Astro.site)} />
    <meta property="twitter:creator" content="@0xgokhan" />
    
    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title={siteName} href="/rss.xml" />
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />
    
    <!-- PWA Meta Tags -->
    <meta name="application-name" content={siteName} />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content={siteName} />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="msapplication-config" content="/browserconfig.xml" />
    <meta name="msapplication-TileColor" content="#3b82f6" />
    <meta name="theme-color" content="#3b82f6" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/icons/icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180x180.png" />
    
    <!-- Microsoft Tiles -->
    <meta name="msapplication-square70x70logo" content="/icons/icon-72x72.png" />
    <meta name="msapplication-square150x150logo" content="/icons/icon-144x144.png" />
    <meta name="msapplication-square310x310logo" content="/icons/icon-384x384.png" />
    
    <!-- Fonts - Optimized Loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <!-- Substack DNS prefetch for faster iframe loading -->
    <link rel="dns-prefetch" href="https://gokhan.substack.com" />
    <link rel="preconnect" href="https://gokhan.substack.com" />
    
    <!-- Load fonts with swap behavior for instant text rendering -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400;1,600&display=swap"
      media="print"
      onload="this.media='all'"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600&display=swap"
      media="print"
      onload="this.media='all'"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap"
      media="print"
      onload="this.media='all'"
    />
    
    <!-- Fallback for users with JS disabled -->
    <noscript>
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400;1,600&display=swap" />
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600&display=swap" />
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap" />
    </noscript>
    
    <!-- Critical CSS - Inlined for First Contentful Paint Optimization -->
    <style is:inline set:html={criticalStyles}></style>


    <!-- Font loading progressive enhancement -->
    <script is:inline>
      document.documentElement.classList.add('js');

      const markFontsLoaded = () => {
        document.documentElement.classList.add('fonts-loaded');
      };

      if ('fonts' in document) {
        Promise.all([
          document.fonts.load('400 1em "Crimson Text"'),
          document.fonts.load('600 1em "Source Sans Pro"')
        ]).then(markFontsLoaded).catch(markFontsLoaded);

        document.fonts.ready.then(markFontsLoaded).catch(markFontsLoaded);
      } else {
        window.addEventListener('load', markFontsLoaded);
      }
    </script>
    
    <!-- Google Analytics - Load by Default -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TSMR6G8LLL"></script>
    <script is:inline>
      // Initialize dataLayer and gtag function
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      
      // Initialize GA with timestamp
      gtag('js', new Date());
      
      // Check if user has opted out
      const privacyChoice = localStorage.getItem('privacy-choice');
      
      if (privacyChoice === 'declined') {
        // User has opted out - disable tracking
        gtag('config', 'G-TSMR6G8LLL', {
          'anonymize_ip': true,
          'allow_google_signals': false,
          'allow_ad_personalization_signals': false,
          'send_page_view': false
        });
      } else {
        // Default behavior - track all users
        gtag('config', 'G-TSMR6G8LLL', {
          'anonymize_ip': true,
          'allow_google_signals': false,
          'allow_ad_personalization_signals': false
        });
      }
      
      // Expose functions globally for privacy notice component
      window.enableGoogleAnalytics = function() {
        gtag('config', 'G-TSMR6G8LLL', {
          'anonymize_ip': true,
          'allow_google_signals': false,
          'allow_ad_personalization_signals': false
        });
        // Send current page view if it was disabled
        gtag('event', 'page_view', {
          page_title: document.title,
          page_location: window.location.href
        });
      };
      
      window.disableGoogleAnalytics = function() {
        gtag('config', 'G-TSMR6G8LLL', {
          'anonymize_ip': true,
          'allow_google_signals': false,
          'allow_ad_personalization_signals': false,
          'send_page_view': false
        });
      };
    </script>
    
    <!-- Structured Data - Person Schema -->
    <script is:inline type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Gökhan Turhan",
      "alternateName": "0xgokhan",
      "description": "T-shaped generalist founder, researcher, and Strategic Innovation Architect operating across fintech, deep tech, competitive governance, art markets, and investment strategies. His work sits at the junction of stablecoins, real-world assets, tokenization, cryptography, AGI timelines, and global systemic challenges—turning them into high-leverage opportunities through foresight, product growth strategy, and technology expertise.",
      "jobTitle": ["Strategic Innovation Architect", "Founder", "Researcher", "Conceptual Artist"],
      "url": "https://gokhanturhan.com",
      "sameAs": [
        "https://x.com/0xgokhan",
        "https://github.com/avalidurl",
        "https://linkedin.com/in/goekhanturhan",
        "https://warpcast.com/gokhan",
        "https://lens.xyz/u/gokhan",
        "https://bsky.app/profile/gokhan.bsky.social",
        "https://gokhan.substack.com",
        "https://gokhan.mirror.xyz",
        "https://paragraph.xyz/@gokhan",
        "https://0xgokhan.medium.com"
      ],
      "knowsAbout": [
        "Stablecoins", "Real World Assets", "RWA", "Tokenization", "Cryptography", 
        "Artificial General Intelligence", "AGI timelines", "Investment Strategy", 
        "Fintech", "Deep Tech", "Art Markets", "Information Markets", "Sabermetrics",
        "Competitive Governance", "Global Systemic Challenges", "Strategic Innovation",
        "Product Growth Strategy", "Technology Expertise", "Foresight"
      ],
      "hasOccupation": {
        "@type": "Occupation",
        "name": "Strategic Innovation Architect",
        "description": "Turning global systemic challenges into high-leverage opportunities through foresight, product growth strategy, and technology expertise across fintech and deep tech"
      }
    })} />
  </head>

  <body class="min-h-screen bg-background font-sans antialiased">
    <ThemeProvider />
    <div class="relative flex min-h-screen flex-col">
      <Navigation />
      
      <main class="flex-1">
        <slot />
      </main>
      
      <!-- Footer -->
      <footer class="border-t bg-background">
        <div class="container mx-auto px-4 py-8">
          <div class="flex flex-col items-center justify-center space-y-4">
            <!-- Main Footer Links -->
            <div class="flex flex-wrap items-center justify-center gap-4 text-xs text-muted-foreground">
              <span>© 2025 Gökhan Turhan</span>
              <span>•</span>
              <a href="/" class="hover:text-foreground transition-colors">gokhanturhan.com</a>
              <span>•</span>
              <a href="/rss.xml" class="flex items-center gap-1 hover:text-foreground transition-colors">
                <span class="inline-flex items-center rounded bg-orange-100 px-1.5 py-0.5 text-xs font-medium text-orange-800 dark:bg-orange-900/30 dark:text-orange-400">RSS</span>
              </a>
              <span>•</span>
              <a href="/subscribe" class="hover:text-foreground transition-colors">Newsletter</a>
              <span>•</span>
              <a href="/privacy" class="hover:text-foreground transition-colors">Privacy</a>
              <span>•</span>
              <a href="/disclaimer" class="hover:text-foreground transition-colors">Disclaimer</a>
              <span>•</span>
              <a href="/sitemap-index.xml" class="hover:text-foreground transition-colors">Sitemap</a>
              <span>•</span>
              <a href="https://github.com/avalidurl/gokhan-memex" target="_blank" rel="noopener" class="hover:text-foreground transition-colors">GitHub</a>
            </div>
            
            <!-- Attribution -->
            <div class="flex flex-wrap items-center justify-center gap-3 text-xs text-muted-foreground">
              <span>Built with</span>
              <a href="https://astro.build" target="_blank" rel="noopener" class="inline-flex items-center rounded bg-purple-100 px-1.5 py-0.5 text-xs font-medium text-purple-800 hover:bg-purple-200 transition-colors dark:bg-purple-900/30 dark:text-purple-400 dark:hover:bg-purple-900/50">
                Astro
              </a>
              <span>+</span>
              <a href="https://ui.shadcn.com" target="_blank" rel="noopener" class="inline-flex items-center rounded bg-slate-100 px-1.5 py-0.5 text-xs font-medium text-slate-800 hover:bg-slate-200 transition-colors dark:bg-slate-800/30 dark:text-slate-400 dark:hover:bg-slate-800/50">
                shadcn/ui
              </a>
            </div>
          </div>
        </div>
      </footer>
    </div>
    
    <!-- Privacy Notice -->
    <PrivacyNotice />
    
    <!-- Offline Status Indicator -->
    <OfflineStatus />
  </body>
</html>