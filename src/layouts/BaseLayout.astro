---
import Navigation from '@/components/Navigation.astro'
import ThemeProvider from '@/components/ThemeProvider.astro'
import PrivacyNotice from '@/components/PrivacyNotice.astro'
import OfflineStatus from '@/components/OfflineStatus.astro'
import '@/styles/globals.css'

export interface Props {
  title: string
  description: string
  image?: string
  canonicalURL?: string
  type?: 'website' | 'article'
}

const {
  title,
  description,
  image = '/og-default.png',
  canonicalURL = new URL(Astro.url.pathname, Astro.site),
  type = 'website'
} = Astro.props

const siteName = 'Gökhan Turhan'
const fullTitle = title === siteName ? title : `${title} | ${siteName}`
---

<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    
    <!-- SEO -->
    <title>{fullTitle}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={type} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={fullTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(image, Astro.site)} />
    <meta property="og:site_name" content={siteName} />
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={fullTitle} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={new URL(image, Astro.site)} />
    <meta property="twitter:creator" content="@0xgokhan" />
    
    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title={siteName} href="/rss.xml" />
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />
    
    <!-- PWA Meta Tags -->
    <meta name="application-name" content={siteName} />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content={siteName} />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="msapplication-config" content="/browserconfig.xml" />
    <meta name="msapplication-TileColor" content="#3b82f6" />
    <meta name="theme-color" content="#3b82f6" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/icons/icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180x180.png" />
    
    <!-- Microsoft Tiles -->
    <meta name="msapplication-square70x70logo" content="/icons/icon-72x72.png" />
    <meta name="msapplication-square150x150logo" content="/icons/icon-144x144.png" />
    <meta name="msapplication-square310x310logo" content="/icons/icon-384x384.png" />
    
    <!-- Fonts - Optimized Loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <!-- Substack DNS prefetch for faster iframe loading -->
    <link rel="dns-prefetch" href="https://gokhan.substack.com" />
    <link rel="preconnect" href="https://gokhan.substack.com" />
    
    <!-- Preload critical fonts -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400;1,600&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    
    <!-- Fallback for users with JS disabled -->
    <noscript>
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400;1,600&display=swap" />
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600&display=swap" />
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap" />
    </noscript>
    
    <!-- Critical CSS - Inlined for First Contentful Paint Optimization -->
    <style>
      /* Critical CSS Variables - Light Theme */
      :root {
        --background: 0 0% 100%;
        --foreground: 222.2 84% 4.9%;
        --card: 0 0% 100%;
        --card-foreground: 222.2 84% 4.9%;
        --primary: 217 33% 17%;
        --primary-foreground: 0 0% 100%;
        --secondary: 210 40% 96%;
        --secondary-foreground: 222.2 84% 4.9%;
        --muted: 210 40% 96%;
        --muted-foreground: 215.4 16.3% 46.9%;
        --accent: 35 52% 65%;
        --accent-foreground: 217 33% 17%;
        --border: 214.3 31.8% 91.4%;
        --input: 214.3 31.8% 91.4%;
        --ring: 217 33% 17%;
        --radius: 0.5rem;
      }

      /* Critical CSS Variables - Dark Theme */
      .dark {
        --background: 222.2 84% 4.9%;
        --foreground: 210 40% 98%;
        --card: 222.2 84% 4.9%;
        --card-foreground: 210 40% 98%;
        --primary: 35 52% 65%;
        --primary-foreground: 222.2 84% 4.9%;
        --secondary: 217.2 32.6% 17.5%;
        --secondary-foreground: 210 40% 98%;
        --muted: 217.2 32.6% 17.5%;
        --muted-foreground: 215 20.2% 65.1%;
        --accent: 217 33% 17%;
        --accent-foreground: 210 40% 98%;
        --border: 217.2 32.6% 17.5%;
        --input: 217.2 32.6% 17.5%;
        --ring: 35 52% 65%;
      }

      /* Critical Base Styles */
      * {
        border-color: hsl(var(--border));
        box-sizing: border-box;
      }

      html {
        height: 100%;
        font-family: 'Crimson Text', Georgia, 'Times New Roman', Times, serif;
        font-size: 18px;
        line-height: 1.6;
        -webkit-text-size-adjust: 100%;
        -moz-tab-size: 4;
        tab-size: 4;
      }

      body {
        height: 100%;
        background-color: hsl(var(--background));
        color: hsl(var(--foreground));
        font-family: 'Crimson Text', Georgia, 'Times New Roman', Times, serif;
        font-size: 1.125rem;
        font-feature-settings: "kern" 1, "liga" 1;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        margin: 0;
        line-height: inherit;
      }

      /* Critical Layout Classes */
      .min-h-screen { min-height: 100vh; }
      .flex { display: flex; }
      .flex-col { flex-direction: column; }
      .flex-1 { flex: 1 1 0%; }
      .relative { position: relative; }
      .sticky { position: sticky; }
      .top-0 { top: 0; }
      .z-50 { z-index: 50; }
      .w-full { width: 100%; }
      .h-16 { height: 4rem; }
      .container { width: 100%; margin-left: auto; margin-right: auto; padding-left: 2rem; padding-right: 2rem; }
      .items-center { align-items: center; }
      .justify-center { justify-content: center; }
      .space-x-2 > :not([hidden]) ~ :not([hidden]) { --tw-space-x-reverse: 0; margin-right: calc(0.5rem * var(--tw-space-x-reverse)); margin-left: calc(0.5rem * calc(1 - var(--tw-space-x-reverse))); }
      .border-b { border-bottom-width: 1px; }
      .border-t { border-top-width: 1px; }
      .bg-background { background-color: hsl(var(--background)); }
      .bg-background\/95 { background-color: hsl(var(--background) / 0.95); }
      .backdrop-blur { --tw-backdrop-blur: blur(8px); backdrop-filter: var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia); }
      .text-foreground { color: hsl(var(--foreground)); }
      .font-bold { font-weight: 700; }
      .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
      .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
      .font-sans { font-family: 'Source Sans Pro', ui-sans-serif, system-ui, sans-serif; }
      .font-serif { font-family: 'Crimson Text', Georgia, 'Times New Roman', Times, serif; }
      .antialiased { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }

      /* Heading styles using Source Sans Pro */
      h1, h2, h3, h4, h5, h6, .heading {
        font-family: 'Source Sans Pro', ui-sans-serif, system-ui, sans-serif;
        font-weight: 600;
        line-height: 1.2;
        letter-spacing: -0.025em;
      }
      
      h1 { font-size: 2.25rem; line-height: 1.1; font-weight: 700; }
      h2 { font-size: 1.875rem; line-height: 1.2; font-weight: 600; }
      h3 { font-size: 1.5rem; line-height: 1.3; font-weight: 600; }
      h4 { font-size: 1.25rem; line-height: 1.4; font-weight: 600; }
      h5 { font-size: 1.125rem; line-height: 1.4; font-weight: 600; }
      h6 { font-size: 1rem; line-height: 1.5; font-weight: 600; }

      /* Improved readability for body text */
      p, article, .prose {
        line-height: 1.7;
        margin-bottom: 1.25rem;
      }
      
      /* Better spacing between elements */
      h1, h2, h3, h4, h5, h6 {
        margin-top: 2rem;
        margin-bottom: 1rem;
      }
      
      h1:first-child, h2:first-child, h3:first-child, 
      h4:first-child, h5:first-child, h6:first-child {
        margin-top: 0;
      }

      /* Optimize font rendering */
      * {
        text-rendering: optimizeLegibility;
        -webkit-font-feature-settings: "kern" 1;
        font-feature-settings: "kern" 1;
      }

      /* Critical Navigation Styles */
      .mr-4 { margin-right: 1rem; }
      .mr-6 { margin-right: 1.5rem; }
      .hidden { display: none; }
      .px-4 { padding-left: 1rem; padding-right: 1rem; }
      .py-8 { padding-top: 2rem; padding-bottom: 2rem; }
      .mx-auto { margin-left: auto; margin-right: auto; }

      /* Critical Typography */
      .text-4xl { font-size: 2.25rem; line-height: 2.5rem; }
      .text-6xl { font-size: 3.75rem; line-height: 1; }
      .tracking-tight { letter-spacing: -0.025em; }
      .mb-6 { margin-bottom: 1.5rem; }
      .mb-16 { margin-bottom: 4rem; }
      .text-center { text-align: center; }

      /* Critical Responsive Classes */
      @media (min-width: 768px) {
        .md\:flex { display: flex; }
        .md\:hidden { display: none; }
        .md\:text-6xl { font-size: 3.75rem; line-height: 1; }
        .md\:p-12 { padding: 3rem; }
      }

      @media (min-width: 1400px) {
        .container { max-width: 1400px; }
      }

      /* Supports query for backdrop-filter */
      @supports (backdrop-filter: blur(8px)) {
        .supports-\[backdrop-filter\]\:bg-background\/60 { background-color: hsl(var(--background) / 0.6); }
      }

      /* Font loading optimization */
      html:not(.fonts-loaded) body {
        font-display: swap;
        visibility: hidden;
      }
      
      html.fonts-loaded body {
        visibility: visible;
      }
      
      /* Ensure content is visible for non-JS users */
      html:not(.js) body {
        visibility: visible !important;
      }
    </style>


    <!-- Font loading optimization script -->
    <script is:inline>
      // Mark JavaScript as available
      document.documentElement.classList.add('js');
      
      // Optimize font loading with swap fallback
      (function() {
        if ('fonts' in document) {
          // Use CSS Font Loading API if available - load both primary fonts
          Promise.all([
            document.fonts.load('400 1em "Crimson Text"'),
            document.fonts.load('600 1em "Source Sans Pro"')
          ]).then(() => {
            document.documentElement.classList.add('fonts-loaded');
          }).catch(() => {
            // Fallback if font loading fails
            document.documentElement.classList.add('fonts-loaded');
          });
        } else {
          // Fallback: add class after short delay
          setTimeout(() => {
            document.documentElement.classList.add('fonts-loaded');
          }, 100);
        }
      })();
    </script>
    
    <!-- Google Analytics - Load by Default -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TSMR6G8LLL"></script>
    <script is:inline>
      // Initialize dataLayer and gtag function
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      
      // Initialize GA with timestamp
      gtag('js', new Date());
      
      // Check if user has opted out
      const privacyChoice = localStorage.getItem('privacy-choice');
      
      if (privacyChoice === 'declined') {
        // User has opted out - disable tracking
        gtag('config', 'G-TSMR6G8LLL', {
          'anonymize_ip': true,
          'allow_google_signals': false,
          'allow_ad_personalization_signals': false,
          'send_page_view': false
        });
      } else {
        // Default behavior - track all users
        gtag('config', 'G-TSMR6G8LLL', {
          'anonymize_ip': true,
          'allow_google_signals': false,
          'allow_ad_personalization_signals': false
        });
      }
      
      // Expose functions globally for privacy notice component
      window.enableGoogleAnalytics = function() {
        gtag('config', 'G-TSMR6G8LLL', {
          'anonymize_ip': true,
          'allow_google_signals': false,
          'allow_ad_personalization_signals': false
        });
        // Send current page view if it was disabled
        gtag('event', 'page_view', {
          page_title: document.title,
          page_location: window.location.href
        });
      };
      
      window.disableGoogleAnalytics = function() {
        gtag('config', 'G-TSMR6G8LLL', {
          'anonymize_ip': true,
          'allow_google_signals': false,
          'allow_ad_personalization_signals': false,
          'send_page_view': false
        });
      };
    </script>
    
    <!-- Structured Data - Person Schema -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Gökhan Turhan",
      "alternateName": "0xgokhan",
      "description": "T-shaped generalist founder, researcher, and Strategic Innovation Architect operating across fintech, deep tech, competitive governance, art markets, and investment strategies. His work sits at the junction of stablecoins, real-world assets, tokenization, cryptography, AGI timelines, and global systemic challenges—turning them into high-leverage opportunities through foresight, product growth strategy, and technology expertise.",
      "jobTitle": ["Strategic Innovation Architect", "Founder", "Researcher", "Conceptual Artist"],
      "url": "https://gokhanturhan.com",
      "sameAs": [
        "https://x.com/0xgokhan",
        "https://github.com/avalidurl",
        "https://linkedin.com/in/goekhanturhan",
        "https://warpcast.com/gokhan",
        "https://lens.xyz/u/gokhan",
        "https://bsky.app/profile/gokhan.bsky.social",
        "https://gokhan.substack.com",
        "https://gokhan.mirror.xyz",
        "https://paragraph.xyz/@gokhan",
        "https://0xgokhan.medium.com"
      ],
      "knowsAbout": [
        "Stablecoins", "Real World Assets", "RWA", "Tokenization", "Cryptography", 
        "Artificial General Intelligence", "AGI timelines", "Investment Strategy", 
        "Fintech", "Deep Tech", "Art Markets", "Information Markets", "Sabermetrics",
        "Competitive Governance", "Global Systemic Challenges", "Strategic Innovation",
        "Product Growth Strategy", "Technology Expertise", "Foresight"
      ],
      "hasOccupation": {
        "@type": "Occupation",
        "name": "Strategic Innovation Architect",
        "description": "Turning global systemic challenges into high-leverage opportunities through foresight, product growth strategy, and technology expertise across fintech and deep tech"
      }
    })} />
  </head>

  <body class="min-h-screen bg-background font-sans antialiased">
    <ThemeProvider />
    <div class="relative flex min-h-screen flex-col">
      <Navigation />
      
      <main class="flex-1">
        <slot />
      </main>
      
      <!-- Footer -->
      <footer class="border-t bg-background">
        <div class="container mx-auto px-4 py-8">
          <div class="flex flex-col items-center justify-center space-y-4">
            <!-- Main Footer Links -->
            <div class="flex flex-wrap items-center justify-center gap-4 text-xs text-muted-foreground">
              <span>© 2025 Gökhan Turhan</span>
              <span>•</span>
              <a href="/" class="hover:text-foreground transition-colors">gokhanturhan.com</a>
              <span>•</span>
              <a href="/rss.xml" class="flex items-center gap-1 hover:text-foreground transition-colors">
                <span class="inline-flex items-center rounded bg-orange-100 px-1.5 py-0.5 text-xs font-medium text-orange-800 dark:bg-orange-900/30 dark:text-orange-400">RSS</span>
              </a>
              <span>•</span>
              <a href="/subscribe" class="hover:text-foreground transition-colors">Newsletter</a>
              <span>•</span>
              <a href="/privacy" class="hover:text-foreground transition-colors">Privacy</a>
              <span>•</span>
              <a href="/disclaimer" class="hover:text-foreground transition-colors">Disclaimer</a>
              <span>•</span>
              <a href="/sitemap-index.xml" class="hover:text-foreground transition-colors">Sitemap</a>
              <span>•</span>
              <a href="https://github.com/avalidurl/gokhan-memex" target="_blank" rel="noopener" class="hover:text-foreground transition-colors">GitHub</a>
            </div>
            
            <!-- Attribution -->
            <div class="flex flex-wrap items-center justify-center gap-3 text-xs text-muted-foreground">
              <span>Built with</span>
              <a href="https://astro.build" target="_blank" rel="noopener" class="inline-flex items-center rounded bg-purple-100 px-1.5 py-0.5 text-xs font-medium text-purple-800 hover:bg-purple-200 transition-colors dark:bg-purple-900/30 dark:text-purple-400 dark:hover:bg-purple-900/50">
                Astro
              </a>
              <span>+</span>
              <a href="https://ui.shadcn.com" target="_blank" rel="noopener" class="inline-flex items-center rounded bg-slate-100 px-1.5 py-0.5 text-xs font-medium text-slate-800 hover:bg-slate-200 transition-colors dark:bg-slate-800/30 dark:text-slate-400 dark:hover:bg-slate-800/50">
                shadcn/ui
              </a>
            </div>
          </div>
        </div>
      </footer>
    </div>
    
    <!-- Privacy Notice -->
    <PrivacyNotice />
    
    <!-- Offline Status Indicator -->
    <OfflineStatus />
  </body>
</html>